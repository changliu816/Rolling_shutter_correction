function [x_k_km1, p_k_km1, x_unftd, A_k] = ekf_predict (x_k_k, p_k_k, idxa, idxb, idxc, anglev, sigma)% ekf filtering prediction stepa_num = length(idxa);b_num = length(idxb);c_num = length(idxc);x_num = a_num+b_num;A_k = zeros(x_num*3,(c_num+a_num)*3);A_k(1:3*a_num, (c_num*3+1):end) = eye(3*a_num);W_k = zeros(x_num*3, b_num*3);W_k((a_num*3+1):end, :) = eye(3*b_num);Q_k = sigma.*eye(b_num*3);% start predictionx_k_km1 = zeros(3*x_num,1);x_k_km1(1:a_num*3) = x_k_k((end-3*a_num+1):end);x_k_km1(a_num*3+1:end) = reshape(anglev(idxb,:)', b_num*3, 1);% x_unftd is the estimation from dynamic model only without filtering% it is used for comparison onlyx_unftd = x_k_km1;x_unftd(1:a_num*3) = reshape(anglev(idxa,:)', a_num*3, 1);p_k_km1 = A_k*p_k_k*A_k' + W_k*Q_k*W_k';